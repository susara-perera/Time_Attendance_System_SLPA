"use strict";(self.webpackChunktime_attendance_frontend=self.webpackChunktime_attendance_frontend||[]).push([[987],{83:(e,i,a)=>{a.d(i,{A:()=>l});a(43);var s=a(769),n=a(579);const l=e=>{let{title:i,subtitle:a,icon:l="bi-folder",actions:d,onBack:t}=e;return(0,n.jsxs)(n.Fragment,{children:[t&&(0,n.jsxs)("button",{className:"back-arrow-btn",onClick:t,title:"Back to Dashboard",style:{marginBottom:"12px",background:"transparent",color:"#0f172a",border:"1px solid rgba(15,23,42,0.08)",width:"auto",padding:"8px 12px"},children:[(0,n.jsx)("i",{className:"bi bi-arrow-left"}),"\xa0",(0,n.jsx)("span",{style:{fontWeight:600},children:"Back"})]}),(0,n.jsxs)("div",{className:"page-header-banner",children:[(0,n.jsxs)("div",{className:"page-header-content",children:[(0,n.jsxs)("div",{className:"page-header-left",children:[(0,n.jsx)("div",{className:"page-header-icon",children:(0,n.jsx)("i",{className:`bi ${l}`})}),(0,n.jsxs)("div",{className:"page-header-text",children:[(0,n.jsx)("h1",{children:i}),a&&(0,n.jsx)("p",{children:a})]})]}),(0,n.jsxs)("div",{className:"page-header-right",children:[d&&(0,n.jsx)("div",{className:"page-header-actions",children:d}),(0,n.jsx)("div",{className:"page-header-logo",children:(0,n.jsx)("img",{src:s,alt:"Company Logo"})})]})]}),(0,n.jsxs)("div",{className:"page-header-decoration",children:[(0,n.jsx)("div",{className:"decoration-circle decoration-circle-1"}),(0,n.jsx)("div",{className:"decoration-circle decoration-circle-2"}),(0,n.jsx)("div",{className:"decoration-circle decoration-circle-3"})]})]})]})}},154:(e,i,a)=>{a.d(i,{M5:()=>o,Vv:()=>t});let s=null;const n=()=>(s||(s=document.createElement("div"),s.id="modern-alert-container",s.className="modern-alert-container",document.body.appendChild(s)),s),l=()=>`alert-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,d=e=>{const i={success:"bi-check-circle-fill",error:"bi-x-circle-fill",warning:"bi-exclamation-triangle-fill",info:"bi-info-circle-fill",question:"bi-question-circle-fill"};return i[e]||i.info},t=e=>{let{type:i="info",title:a="",message:s="",duration:t=3e3,showConfetti:o=!1}=e;const r=n(),v=l(),u=document.createElement("div");if(u.id=v,u.className=`modern-alert modern-alert-${i} modern-alert-enter`,u.innerHTML=`\n    <div class="modern-alert-content">\n      <div class="modern-alert-icon">\n        <i class="bi ${d(i)}"></i>\n      </div>\n      <div class="modern-alert-body">\n        ${a?`<div class="modern-alert-title">${a}</div>`:""}\n        <div class="modern-alert-message">${s}</div>\n      </div>\n      <button class="modern-alert-close" onclick="this.closest('.modern-alert').remove()">\n        <i class="bi bi-x"></i>\n      </button>\n    </div>\n    <div class="modern-alert-progress"></div>\n  `,r.appendChild(u),setTimeout(()=>{u.classList.remove("modern-alert-enter"),u.classList.add("modern-alert-active")},10),o&&"success"===i&&m(),t>0){const e=u.querySelector(".modern-alert-progress");e&&(e.style.animationDuration=`${t}ms`),setTimeout(()=>{c(v)},t)}return v},o=e=>{let{title:i="Confirm",message:a="Are you sure?",confirmText:s="Confirm",cancelText:t="Cancel",type:o="warning",showIcon:c=!0}=e;return new Promise(e=>{const m=n(),v=l(),u=document.createElement("div");u.id=v,u.className="modern-dialog-overlay modern-dialog-enter",u.innerHTML=`\n      <div class="modern-dialog modern-dialog-${o}">\n        <div class="modern-dialog-content">\n          ${c?`\n            <div class="modern-dialog-icon">\n              <i class="bi ${d("danger"===o?"error":o)}"></i>\n            </div>\n          `:""}\n          <div class="modern-dialog-body">\n            <h3 class="modern-dialog-title">${i}</h3>\n            <p class="modern-dialog-message">${a}</p>\n          </div>\n        </div>\n        <div class="modern-dialog-footer">\n          <button class="modern-btn modern-btn-cancel" data-action="cancel">\n            <i class="bi bi-x-circle"></i>\n            ${t}\n          </button>\n          <button class="modern-btn modern-btn-confirm modern-btn-${o}" data-action="confirm">\n            <i class="bi bi-check-circle"></i>\n            ${s}\n          </button>\n        </div>\n      </div>\n    `,m.appendChild(u),setTimeout(()=>{u.classList.remove("modern-dialog-enter"),u.classList.add("modern-dialog-active")},10),u.addEventListener("click",i=>{if(i.target.closest("[data-action]")){const a=i.target.closest("[data-action]").dataset.action;r(v),e("confirm"===a)}else i.target===u&&(r(v),e(!1))})})},c=e=>{const i=document.getElementById(e);i&&(i.classList.remove("modern-alert-active"),i.classList.add("modern-alert-exit"),setTimeout(()=>{i.remove()},300))},r=e=>{const i=document.getElementById(e);i&&(i.classList.remove("modern-dialog-active"),i.classList.add("modern-dialog-exit"),setTimeout(()=>{i.remove()},300))},m=()=>{const e=document.body;for(let i=0;i<50;i++){const i=document.createElement("div");i.className="confetti",i.style.left=100*Math.random()+"%",i.style.animationDelay=.5*Math.random()+"s",i.style.backgroundColor=v(),e.appendChild(i),setTimeout(()=>i.remove(),3e3)}},v=()=>{const e=["#ff6b6b","#4ecdc4","#45b7d1","#f9ca24","#6c5ce7","#a29bfe","#fd79a8"];return e[Math.floor(Math.random()*e.length)]}},987:(e,i,a)=>{a.r(i),a.d(i,{default:()=>o});var s=a(43),n=a(715),l=a(477),d=(a(154),a(83)),t=a(579);const o=e=>{var i,a,o,c;let{onBack:r}=e;const[m,v]=(0,s.useState)([]),[u,h]=(0,s.useState)(!0),[b,N]=(0,s.useState)(!1),[x,g]=(0,s.useState)(!1),[j,p]=(0,s.useState)(null),[f,y]=(0,s.useState)(!0),[S,A]=(0,s.useState)(""),[C,D]=(0,s.useState)("name_asc"),[_,w]=(0,s.useState)({name:"",code:""}),[I,$]=(0,s.useState)({}),[E,k]=(0,s.useState)(!1),L=(0,n.A)("divisions","read"),T=((0,n.A)("divisions","create"),(0,n.A)("divisions","update"),(0,n.A)("divisions","delete"),"http://10.70.4.186:5000/api"),{t:M}=(0,l.ok)(),H=e=>{const i=e=>String(e).padStart(2,"0");return`${e.getFullYear()}-${i(e.getMonth()+1)}-${i(e.getDate())}`},B=e=>"string"===typeof e?e.replace(/\s+/g," ").trim().toLowerCase():"",O=async()=>{try{var e;const a=localStorage.getItem("token"),s=[`${T}/mysql-data/divisions`,`${T}/divisions/hris`];let n,l=null,d=null;for(const e of s){console.log(`Fetching divisions from ${e}...`);try{const i={"Content-Type":"application/json"};if(e.includes("/hris")&&a&&(i.Authorization=`Bearer ${a}`),n=await fetch(e,{headers:i,credentials:"include"}),n.ok){l=await n.json(),console.log("Divisions API Response:",l),d=e,y(e.includes("/hris"));break}{const i=await n.text();console.warn(`Division fetch failed at ${e}:`,n.status,n.statusText,i)}}catch(i){console.error(`Error fetching from ${e}:`,i)}}if(!l||!l.data)return console.error("No division data received from any endpoint"),v([]),void h(!1);const t=(Array.isArray(null===(e=l)||void 0===e?void 0:e.data)?l.data:[]).map(e=>{var i,a,s,n,l,t,o,c,r,m,v,u,h,b,N,x,g,j,p,f,y,S,A,C,D,_,w,I,$,E;return{_id:String(null!==(i=null!==(a=null!==(s=null!==(n=null!==(l=null!==(t=null!==(o=null===e||void 0===e?void 0:e._id)&&void 0!==o?o:null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null===e||void 0===e?void 0:e.DIVISION_ID)&&void 0!==l?l:null===e||void 0===e?void 0:e.code)&&void 0!==n?n:null===e||void 0===e?void 0:e.hie_code)&&void 0!==s?s:null===e||void 0===e?void 0:e.DIVISION_CODE)&&void 0!==a?a:null===e||void 0===e?void 0:e.HIE_CODE)&&void 0!==i?i:""),code:String(null!==(c=null!==(r=null!==(m=null!==(v=null===e||void 0===e?void 0:e.code)&&void 0!==v?v:null===e||void 0===e?void 0:e.DIVISION_CODE)&&void 0!==m?m:null===e||void 0===e?void 0:e.hie_code)&&void 0!==r?r:null===e||void 0===e?void 0:e.HIE_CODE)&&void 0!==c?c:""),name:null!==(u=null!==(h=null!==(b=null!==(N=null!==(x=null===e||void 0===e?void 0:e.name)&&void 0!==x?x:null===e||void 0===e?void 0:e.DIVISION_NAME)&&void 0!==N?N:null===e||void 0===e?void 0:e.hie_name)&&void 0!==b?b:null===e||void 0===e?void 0:e.HIE_NAME)&&void 0!==h?h:null===e||void 0===e?void 0:e.hie_relationship)&&void 0!==u?u:"Unknown Division",nameSinhala:null!==(g=null!==(j=null===e||void 0===e?void 0:e.HIE_NAME_SINHALA)&&void 0!==j?j:null===e||void 0===e?void 0:e.name_sinhala)&&void 0!==g?g:"",nameTamil:null!==(p=null!==(f=null===e||void 0===e?void 0:e.HIE_NAME_TAMIL)&&void 0!==f?f:null===e||void 0===e?void 0:e.name_tamil)&&void 0!==p?p:"",isActive:"boolean"===typeof(null===e||void 0===e?void 0:e.isActive)?e.isActive:"boolean"===typeof(null===e||void 0===e?void 0:e.active)?e.active:"ACTIVE"===(null===e||void 0===e?void 0:e.STATUS),employeeCount:null!==(y=null!==(S=null===e||void 0===e?void 0:e.employeeCount)&&void 0!==S?S:null===e||void 0===e?void 0:e.count)&&void 0!==y?y:void 0,createdAt:null!==(A=null!==(C=null!==(D=null!==(_=null!==(w=null!==(I=null===e||void 0===e?void 0:e.createdAt)&&void 0!==I?I:null===e||void 0===e?void 0:e.created_at)&&void 0!==w?w:null===e||void 0===e?void 0:e.CREATED_AT)&&void 0!==_?_:null===e||void 0===e?void 0:e.createdOn)&&void 0!==D?D:null===e||void 0===e?void 0:e.CREATED_ON)&&void 0!==C?C:null===e||void 0===e?void 0:e.synced_at)&&void 0!==A?A:null,source:null!==($=null===e||void 0===e?void 0:e.source)&&void 0!==$?$:null!==(E=d)&&void 0!==E&&E.includes("/mysql-data")?"MySQL Sync":"HRIS"}});v(t)}catch(a){console.error("Error fetching divisions:",a),v([])}finally{h(!1)}};return(0,s.useEffect)(()=>{O()},[]),u?(0,t.jsx)("div",{className:"loading-container",children:M("loading")}):L?(0,t.jsxs)("div",{className:"division-management",children:[(0,t.jsx)(d.A,{title:M("divisionManagementTitle"),subtitle:"Manage organizational divisions and view division details",icon:"bi-building",onBack:r}),(0,t.jsx)("div",{className:"dm-controls-section",children:(0,t.jsxs)("div",{className:"dm-controls-inner",children:[(0,t.jsxs)("div",{className:"dm-search-group",children:[(0,t.jsxs)("label",{htmlFor:"divisionSort",className:"dm-label",children:[(0,t.jsx)("i",{className:"bi bi-sort-alpha-down"})," Sort By:"]}),(0,t.jsxs)("select",{id:"divisionSort",value:C,onChange:e=>D(e.target.value),className:"dm-select",children:[(0,t.jsx)("option",{value:"name_asc",children:"Name A \u2192 Z"}),(0,t.jsx)("option",{value:"name_desc",children:"Name Z \u2192 A"}),(0,t.jsx)("option",{value:"id_asc",children:"ID Small \u2192 High"}),(0,t.jsx)("option",{value:"id_desc",children:"ID High \u2192 Small"})]})]}),(0,t.jsxs)("div",{className:"dm-search-group dm-search-input-group",children:[(0,t.jsx)("i",{className:"bi bi-search dm-search-icon"}),(0,t.jsx)("input",{id:"divisionSearch",type:"text",className:"dm-search-input",placeholder:M("divisionSearchPlaceholder"),value:S,onChange:e=>A(e.target.value)})]}),(0,t.jsxs)("div",{className:"dm-stats-badge",children:[(0,t.jsx)("i",{className:"bi bi-building"}),(0,t.jsxs)("span",{children:[m.length," Divisions"]})]})]})}),(0,t.jsx)("div",{className:"dm-table-card",children:(0,t.jsxs)("div",{className:"dm-table-wrapper",children:[(0,t.jsxs)("table",{className:"dm-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:(0,t.jsxs)("div",{className:"dm-th-content",children:[(0,t.jsx)("i",{className:"bi bi-hash"}),"Division ID"]})}),(0,t.jsx)("th",{children:(0,t.jsxs)("div",{className:"dm-th-content",children:[(0,t.jsx)("i",{className:"bi bi-building"}),"Division Name"]})}),(0,t.jsx)("th",{children:(0,t.jsxs)("div",{className:"dm-th-content",children:[(0,t.jsx)("i",{className:"bi bi-gear"}),"Action"]})})]})}),(0,t.jsx)("tbody",{children:(()=>{const e=B(S),i=e?m.filter(i=>{const a=B(i.code||""),s=B(i.name||"");return a.includes(e)||s.includes(e)}):m,a=e=>String((null===e||void 0===e?void 0:e.name)||"").toLowerCase(),s=e=>{var i,a;const s=null!==(i=null!==(a=null===e||void 0===e?void 0:e.code)&&void 0!==a?a:null===e||void 0===e?void 0:e._id)&&void 0!==i?i:"",n=Number(String(s).replace(/[^0-9.-]/g,""));return Number.isFinite(n)?n:String(s)};return i.slice().sort((e,i)=>{if("name_asc"===C)return a(e).localeCompare(a(i));if("name_desc"===C)return a(i).localeCompare(a(e));if("id_asc"===C){const a=s(e),n=s(i);return"number"===typeof a&&"number"===typeof n?a-n:String(a).localeCompare(String(n))}if("id_desc"===C){const a=s(e),n=s(i);return"number"===typeof a&&"number"===typeof n?n-a:String(n).localeCompare(String(a))}return 0}).map((e,i)=>(0,t.jsxs)("tr",{className:"dm-table-row",style:{"--delay":.03*i+"s"},children:[(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"dm-code-badge",children:e.code})}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"dm-name-cell",children:[(0,t.jsx)("span",{className:"dm-division-name",children:e.name}),void 0!==e.isActive&&(0,t.jsx)("span",{className:"dm-status-dot "+(e.isActive?"active":"inactive")})]})}),(0,t.jsx)("td",{children:(0,t.jsxs)("button",{className:"dm-view-btn",onClick:()=>p(e),title:M("viewDivisionDetails"),children:[(0,t.jsx)("i",{className:"bi bi-eye"}),(0,t.jsx)("span",{children:M("viewLabel")})]})})]},e._id||e.code||e.name))})()})]}),0===m.length&&(0,t.jsxs)("div",{className:"dm-no-data",children:[(0,t.jsx)("i",{className:"bi bi-folder-x"}),(0,t.jsx)("p",{children:M("noDivisionsFoundMsg")})]})]})}),j&&(0,t.jsx)("div",{className:"dm-modal-overlay",onClick:()=>p(null),children:(0,t.jsxs)("div",{className:"dm-modal-container",onClick:e=>e.stopPropagation(),role:"dialog","aria-modal":"true","aria-label":M("divisionDetailsTitle"),children:[(0,t.jsxs)("div",{className:"dm-modal-header-enhanced",children:[(0,t.jsxs)("div",{className:"dm-modal-header-content",children:[(0,t.jsx)("div",{className:"dm-modal-icon-wrapper",children:(0,t.jsx)("i",{className:"bi bi-building"})}),(0,t.jsxs)("div",{className:"dm-modal-title-section",children:[(0,t.jsx)("h3",{children:M("divisionDetailsTitle")||"Division Details"}),(0,t.jsx)("span",{className:"dm-modal-subtitle",children:"View division information"})]})]}),(0,t.jsx)("button",{className:"dm-modal-close-enhanced",onClick:()=>p(null),"aria-label":M("close"),children:(0,t.jsx)("i",{className:"bi bi-x-lg"})})]}),(0,t.jsxs)("div",{className:"dm-modal-body-enhanced",children:[(0,t.jsxs)("div",{className:"dm-detail-highlight",children:[(0,t.jsx)("div",{className:"dm-detail-highlight-icon",children:(0,t.jsx)("i",{className:"bi bi-building-fill"})}),(0,t.jsxs)("div",{className:"dm-detail-highlight-content",children:[(0,t.jsx)("span",{className:"dm-detail-highlight-label",children:"Division Name"}),(0,t.jsx)("h4",{className:"dm-detail-highlight-value",children:null!==(i=j.name)&&void 0!==i?i:M("naLabel")})]})]}),(0,t.jsxs)("div",{className:"dm-details-grid",children:[(0,t.jsxs)("div",{className:"dm-detail-item",children:[(0,t.jsx)("div",{className:"dm-detail-icon",children:(0,t.jsx)("i",{className:"bi bi-fingerprint"})}),(0,t.jsxs)("div",{className:"dm-detail-content",children:[(0,t.jsx)("span",{className:"dm-detail-label",children:"ID"}),(0,t.jsx)("span",{className:"dm-detail-value",children:null!==(a=j._id)&&void 0!==a?a:j.id||M("naLabel")})]})]}),(0,t.jsxs)("div",{className:"dm-detail-item",children:[(0,t.jsx)("div",{className:"dm-detail-icon",children:(0,t.jsx)("i",{className:"bi bi-upc-scan"})}),(0,t.jsxs)("div",{className:"dm-detail-content",children:[(0,t.jsx)("span",{className:"dm-detail-label",children:"Code"}),(0,t.jsx)("span",{className:"dm-detail-value dm-code",children:null!==(o=j.code)&&void 0!==o?o:M("naLabel")})]})]}),(0,t.jsxs)("div",{className:"dm-detail-item",children:[(0,t.jsx)("div",{className:"dm-detail-icon",children:(0,t.jsx)("i",{className:"bi bi-toggle-on"})}),(0,t.jsxs)("div",{className:"dm-detail-content",children:[(0,t.jsx)("span",{className:"dm-detail-label",children:"Status"}),(0,t.jsx)("span",{className:"dm-detail-status "+("boolean"===typeof j.isActive?j.isActive?"active":"inactive":""),children:"boolean"===typeof j.isActive?j.isActive?"Active":"Inactive":M("naLabel")})]})]}),(0,t.jsxs)("div",{className:"dm-detail-item",children:[(0,t.jsx)("div",{className:"dm-detail-icon",children:(0,t.jsx)("i",{className:"bi bi-people-fill"})}),(0,t.jsxs)("div",{className:"dm-detail-content",children:[(0,t.jsx)("span",{className:"dm-detail-label",children:"Employee Count"}),(0,t.jsx)("span",{className:"dm-detail-value dm-count",children:null!==(c=j.employeeCount)&&void 0!==c?c:0})]})]}),(0,t.jsxs)("div",{className:"dm-detail-item dm-detail-full",children:[(0,t.jsx)("div",{className:"dm-detail-icon",children:(0,t.jsx)("i",{className:"bi bi-calendar-check"})}),(0,t.jsxs)("div",{className:"dm-detail-content",children:[(0,t.jsx)("span",{className:"dm-detail-label",children:"Created At"}),(0,t.jsx)("span",{className:"dm-detail-value",children:j.createdAt?(e=>{if(!e)return"";try{if("string"===typeof e){const i=Number(e);if(!Number.isNaN(i)&&""!==e.trim()){const e=new Date(i);return Number.isNaN(e)?"":H(e)}const a=new Date(e);return Number.isNaN(a)?"":H(a)}if("number"===typeof e){const i=new Date(e);return Number.isNaN(i)?"":H(i)}if("object"===typeof e){if(e.$date){const i=e.$date;if("object"===typeof i&&i.$numberLong){const e=new Date(Number(i.$numberLong));return Number.isNaN(e)?"":H(e)}if("string"===typeof i||"number"===typeof i){const e=new Date(i);return Number.isNaN(e)?"":H(e)}}if(e.$numberLong){const i=new Date(Number(e.$numberLong));return Number.isNaN(i)?"":H(i)}}}catch(i){return""}return""})(j.createdAt)||String(j.createdAt):M("naLabel")})]})]})]})]}),(0,t.jsx)("div",{className:"dm-modal-footer-enhanced",children:(0,t.jsxs)("button",{className:"dm-btn-close",onClick:()=>p(null),children:[(0,t.jsx)("i",{className:"bi bi-x-circle"}),"Close"]})})]})})]}):(0,t.jsxs)("div",{className:"division-management",children:[(0,t.jsx)(d.A,{title:M("divisionManagementTitle"),subtitle:"Manage organizational divisions and view division details",icon:"bi-building"}),(0,t.jsx)("div",{className:"professional-card",children:(0,t.jsx)("div",{className:"no-data",children:(0,t.jsx)("p",{children:M("noPermissionViewDivisions")})})})]})}}}]);
//# sourceMappingURL=987.9e79b4e7.chunk.js.map