"use strict";(self.webpackChunktime_attendance_frontend=self.webpackChunktime_attendance_frontend||[]).push([[366],{83:(e,s,i)=>{i.d(s,{A:()=>n});i(43);var l=i(769),a=i(579);const n=e=>{let{title:s,subtitle:i,icon:n="bi-folder",actions:t,onBack:o}=e;return(0,a.jsxs)(a.Fragment,{children:[o&&(0,a.jsxs)("button",{className:"back-arrow-btn",onClick:o,title:"Back to Dashboard",style:{marginBottom:"12px",background:"transparent",color:"#0f172a",border:"1px solid rgba(15,23,42,0.08)",width:"auto",padding:"8px 12px"},children:[(0,a.jsx)("i",{className:"bi bi-arrow-left"}),"\xa0",(0,a.jsx)("span",{style:{fontWeight:600},children:"Back"})]}),(0,a.jsxs)("div",{className:"page-header-banner",children:[(0,a.jsxs)("div",{className:"page-header-content",children:[(0,a.jsxs)("div",{className:"page-header-left",children:[(0,a.jsx)("div",{className:"page-header-icon",children:(0,a.jsx)("i",{className:`bi ${n}`})}),(0,a.jsxs)("div",{className:"page-header-text",children:[(0,a.jsx)("h1",{children:s}),i&&(0,a.jsx)("p",{children:i})]})]}),(0,a.jsxs)("div",{className:"page-header-right",children:[t&&(0,a.jsx)("div",{className:"page-header-actions",children:t}),(0,a.jsx)("div",{className:"page-header-logo",children:(0,a.jsx)("img",{src:l,alt:"Company Logo"})})]})]}),(0,a.jsxs)("div",{className:"page-header-decoration",children:[(0,a.jsx)("div",{className:"decoration-circle decoration-circle-1"}),(0,a.jsx)("div",{className:"decoration-circle decoration-circle-2"}),(0,a.jsx)("div",{className:"decoration-circle decoration-circle-3"})]})]})]})}},366:(e,s,i)=>{i.r(s),i.d(s,{default:()=>o});var l=i(43),a=i(477),n=i(83),t=i(579);const o=e=>{let{onBack:s}=e;const[i,o]=(0,l.useState)([]),[c,r]=(0,l.useState)([]),[d,m]=(0,l.useState)([]),[h,x]=(0,l.useState)({divisionId:"",sectionId:"",mealDate:(new Date).toISOString().split("T")[0],mealType:"",quantity:1,specialRequirements:""}),[j,u]=(0,l.useState)(!1),[g,p]=(0,l.useState)(""),[b,v]=(0,l.useState)(""),[N,y]=(0,l.useState)(0),{t:f}=(0,a.ok)(),I="http://10.70.4.186:5000/api",[S,_]=(0,l.useState)(null),k=e=>{if(!e)return"";let s=String(e).replace(/\s*\([^)]*\)/g,"").trim();return s=s.replace(/\s*-\s*$/,"").trim(),s},[E,w]=(0,l.useState)(!1),[D,C]=(0,l.useState)(!1),[A,O]=(0,l.useState)(!1),[T,M]=(0,l.useState)(null),[$,B]=(0,l.useState)(!1),[F,P]=(0,l.useState)(""),[q,R]=(0,l.useState)([]),[L,V]=(0,l.useState)([]),[z,H]=(0,l.useState)([]),[U,G]=(0,l.useState)("meal"),[Y,J]=(0,l.useState)("all"),[Q,W]=(0,l.useState)("all"),[K,X]=(0,l.useState)("all"),[Z,ee]=(0,l.useState)([]),[se,ie]=(0,l.useState)([]),[le,ae]=(0,l.useState)(!1),[ne,te]=(0,l.useState)(!1),[oe,ce]=(0,l.useState)("all"),[re,de]=(0,l.useState)("all"),[me,he]=(0,l.useState)("all"),[xe,je]=(0,l.useState)([]),[ue,ge]=(0,l.useState)([]),[pe,be]=(0,l.useState)([]),[ve,Ne]=(0,l.useState)(!1),[ye,fe]=(0,l.useState)(!1),[Ie,Se]=(0,l.useState)(!1),[_e,ke]=(0,l.useState)("meal");(0,l.useEffect)(()=>{Ee(),we(),De(),Ce(),Se(!1)},[]),(0,l.useEffect)(()=>{if(S&&i.length>0&&d.length>0){var e,s;const i=(null===(e=S.division)||void 0===e?void 0:e._id)||S.division||S.divisionId,l=(null===(s=S.section)||void 0===s?void 0:s._id)||S.section||S.sectionId;i&&!h.divisionId&&x(e=>({...e,divisionId:i,sectionId:l||""}))}},[S,i,d]),(0,l.useEffect)(()=>{if(h.divisionId&&""!==h.divisionId){const e=d.filter(e=>String(e.division_id||e.divisionId||e.DIVISION_ID||"")===String(h.divisionId));console.log(`\ud83d\udd0d Filtered ${e.length} sections for division ${h.divisionId}`),r(e),x(e=>({...e,sectionId:""}))}else r(d),x(e=>({...e,sectionId:""}))},[h.divisionId,d]),(0,l.useEffect)(()=>{if("all"===Y)ee(d),W("all"),ie([]),X("all");else{const e=d.filter(e=>String(e.division_id||e.divisionId||e.DIVISION_ID||"")===String(Y));ee(e),W("all"),ie([]),X("all")}},[Y,d]),(0,l.useEffect)(()=>{Oe()},[F,Y,Q,K,q]);const Ee=async()=>{if(!S)try{const e=localStorage.getItem("token"),s=await fetch(`${I}/auth/verify`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(s.ok){const e=await s.json();e.success&&e.user&&(console.log("\ud83d\udc64 User info loaded:",e.user),_(e.user))}}catch(e){console.error("Error fetching user info:",e)}},we=async()=>{try{const e=localStorage.getItem("token");console.log("\ud83d\udce5 Fetching HRIS divisions...");const s=await fetch(`${I}/divisions/hris`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(s.ok){const e=await s.json();let i=[];Array.isArray(e)?i=e:e.data&&Array.isArray(e.data)&&(i=e.data);const l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const s=[],i=new Set;return e.forEach(e=>{var l,a,n,t,o,c,r,d,m,h,x,j,u,g,p,b,v,N;const y=String(null!==(l=null!==(a=null!==(n=null!==(t=null!==(o=null!==(c=e._id)&&void 0!==c?c:e.id)&&void 0!==o?o:e.DIVISION_ID)&&void 0!==t?t:e.code)&&void 0!==n?n:e.hie_code)&&void 0!==a?a:e.DIVISION_CODE)&&void 0!==l?l:"");y&&(i.has(y)||(i.add(y),s.push({_id:y,id:y,division_id:y,code:String(null!==(r=null!==(d=null!==(m=null!==(h=null!==(x=e.code)&&void 0!==x?x:e.DIVISION_CODE)&&void 0!==h?h:e.hie_code)&&void 0!==m?m:e._id)&&void 0!==d?d:e.id)&&void 0!==r?r:y),name:null!==(j=null!==(u=null!==(g=null!==(p=e.name)&&void 0!==p?p:e.DIVISION_NAME)&&void 0!==g?g:e.hie_name)&&void 0!==u?u:e.hie_relationship)&&void 0!==j?j:"Unknown Division",division_name:null!==(b=null!==(v=null!==(N=e.name)&&void 0!==N?N:e.DIVISION_NAME)&&void 0!==v?v:e.hie_name)&&void 0!==b?b:"Unknown Division"})))}),s.sort((e,s)=>e.name.localeCompare(s.name))}(i);console.log(`\u2705 Loaded ${l.length} HRIS divisions`),o(l)}else console.error("Failed to fetch divisions:",s.status),o([])}catch(e){console.error("Error fetching divisions:",e),p(f("errorFetchingDivisions")),v("error"),o([])}},De=async()=>{try{const e=localStorage.getItem("token");console.log("\ud83d\udce5 Fetching HRIS sections...");let s=await fetch(`${I}/sections/hris`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(s.ok||(console.warn("HRIS sections endpoint returned non-OK, falling back to /api/sections",s.status),s=await fetch(`${I}/sections`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})),s.ok){const e=await s.json();let i=[];Array.isArray(e)?i=e:e.data&&Array.isArray(e.data)?i=e.data:e.sections&&Array.isArray(e.sections)&&(i=e.sections);const l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const s=[],i=new Set;return e.forEach(e=>{var l,a,n,t,o,c,r,d,m,h,x,j,u,g,p,b,v,N,y,f,I,S,_;const k=String(null!==(l=null!==(a=null!==(n=null!==(t=null!==(o=null!==(c=null!==(r=e._id)&&void 0!==r?r:e.id)&&void 0!==c?c:e.SECTION_ID)&&void 0!==o?o:e.code)&&void 0!==t?t:e.hie_code)&&void 0!==n?n:e.SECTION_CODE)&&void 0!==a?a:e.section_code)&&void 0!==l?l:"");if(!k)return;if(i.has(k))return;i.add(k);const E=String(null!==(d=null!==(m=null!==(h=null!==(x=null!==(j=e.division_id)&&void 0!==j?j:e.DIVISION_ID)&&void 0!==x?x:e.division_code)&&void 0!==h?h:e.DIVISION_CODE)&&void 0!==m?m:e.hie_relationship)&&void 0!==d?d:"");s.push({_id:k,id:k,section_id:k,code:String(null!==(u=null!==(g=null!==(p=null!==(b=e.code)&&void 0!==b?b:e.SECTION_CODE)&&void 0!==p?p:e.hie_code)&&void 0!==g?g:e.section_code)&&void 0!==u?u:k),name:null!==(v=null!==(N=null!==(y=null!==(f=e.name)&&void 0!==f?f:e.section_name)&&void 0!==y?y:e.SECTION_NAME)&&void 0!==N?N:e.hie_relationship)&&void 0!==v?v:`Section ${k}`,section_name:null!==(I=null!==(S=null!==(_=e.name)&&void 0!==_?_:e.section_name)&&void 0!==S?S:e.SECTION_NAME)&&void 0!==I?I:`Section ${k}`,division_id:E||"",divisionId:E||"",DIVISION_ID:E||""})}),s.sort((e,s)=>e.name.localeCompare(s.name))}(i);console.log(`\u2705 Loaded ${l.length} HRIS sections`),console.log("Sample sections with division_id:",l.slice(0,3).map(e=>({section:e.name,section_id:e._id,division_id:e.division_id}))),m(l),r(l)}else console.error("Failed to fetch sections:",s.status,s.statusText),m([]),r([])}catch(e){console.error("Error fetching sections:",e),p(f("errorFetchingSections")),v("error"),m([]),r([])}},Ce=async()=>{try{const e=localStorage.getItem("token"),s=await fetch(`${I}/meals/bookings/today/count`,{headers:{Authorization:`Bearer ${e}`}}),i=await s.json();s.ok&&i.success&&y(i.count||0)}catch(e){console.error("Error fetching today's bookings:",e)}},Ae=async()=>{if(!F||F.trim().length<2)return p("Please enter at least 2 characters to search"),void v("warning");ae(!0);try{const e=await fetch(`http://localhost:5000/api/employee/hris/search?q=${encodeURIComponent(F)}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const s=await e.json();R(s),p(""),0===s.length&&(p("No employees found"),v("info"))}else p("Failed to search employees"),v("danger")}catch(e){console.error("Error searching HRIS employees:",e),p("Error searching employees"),v("danger")}finally{ae(!1)}},Oe=()=>{let e=[...q];"all"!==Y&&(e=e.filter(e=>String(e.division_id||e.divisionId||e.DIVISION_ID||"")===String(Y))),"all"!==Q&&(e=e.filter(e=>String(e.section_id||e.sectionId||e.SECTION_ID||"")===String(Q))),"all"!==K&&(e=e.filter(e=>String(e.subsection_id||e.subsectionId||e.SUBSECTION_ID||"")===String(K))),V(e)},Te=e=>{const s=e.employee_id||e.id||e.EMPLOYEE_ID,i=z.some(e=>(e.employee_id||e.id||e.EMPLOYEE_ID)===s);H(i?z.filter(e=>(e.employee_id||e.id||e.EMPLOYEE_ID)!==s):[...z,e])},Me=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||L;z.length===e.length&&e.length>0?H([]):H([...e])},$e=async()=>{if("all"===oe||"all"===re)return p("Please select both Division and Section to search"),void v("warning");Ne(!0),be([]),H([]);try{const e=localStorage.getItem("token"),s=i.find(e=>e.division_id===oe),l=d.find(e=>e.section_id===re);if(!s||!l)return p("Invalid division or section selected"),v("danger"),void Ne(!1);console.log("\ud83d\udd0d Searching HRIS for division:",s.code,s.name,"section:",l.code,l.name);const a=s.code||s.division_id||s._id,n=l.code||l.section_id||l._id;console.log("Using codes - Division:",a,"Section:",n);const t=await fetch("http://localhost:5000/api/users/hris",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)return p("Failed to fetch HRIS employees"),v("danger"),void Ne(!1);const o=await t.json();let c=[];Array.isArray(o)?c=o:o.data&&Array.isArray(o.data)?c=o.data:o.employees&&Array.isArray(o.employees)&&(c=o.employees),console.log(`\ud83d\udcca Got ${c.length} total employees from HRIS`),c.length>0&&(console.log("\ud83d\udccb Sample employee structure:",c[0]),console.log("\ud83d\udd11 Sample employee keys:",Object.keys(c[0]))),console.log("\ud83c\udfaf Target Division:",oe,a,s),console.log("\ud83c\udfaf Target Section:",re,n,l),console.log("\ud83d\udd11 Section object full:",l);const r=String(s.code||s.DIVISION_CODE||a).trim(),m=String(l.code||l.SECTION_CODE||n).trim();console.log("\ud83d\udccd Using codes for matching - Division:",r,"Section:",m);let h=0;const x=c.filter(e=>{const s=String(e.DIVISION_CODE||e.division_code||"").trim(),i=String(e.SECTION_CODE||e.section_code||"").trim(),l=s===r,a=i===m;return h<5&&console.log(`Employee ${e.EMP_NUMBER||e._id}:`,{empDiv:s,targetDiv:r,divMatch:l,empSec:i,targetSec:m,secMatch:a,result:l&&a?"\u2705 MATCH":"\u274c NO MATCH"}),l&&a&&h++,l&&a});console.log(`\u2705 Filtered to ${x.length} employees for division ${a} and section ${n}`),x.length>0&&console.log("\u2705 Sample filtered employee:",x[0]);const j=x.map(e=>({employee_id:e.EMP_NUMBER||e.EMPLOYEE_ID||e.employee_id||e._id,employee_name:e.FULLNAME||e.EMPLOYEE_NAME||e.employee_name||e.name||`${e.CALLING_NAME||e.FIRST_NAME||""} ${e.LAST_NAME||""}`.trim(),division_id:e.DIVISION_CODE||e.division_code||e.DIVISION_ID,division_code:e.DIVISION_CODE||e.division_code,division_name:e.DIVISION_NAME||e.division_name||s.division_name||s.name,section_id:e.SECTION_CODE||e.section_code||e.SECTION_ID,section_code:e.SECTION_CODE||e.section_code,section_name:e.SECTION_NAME||e.section_name||l.section_name||l.name,email:e.EMAIL||e.email||""}));console.log(`\ud83c\udfaf Found ${j.length} employees for division ${a} and section ${n}`),be(j),ke("search"),0===j.length?(p("No employees found for selected filters"),v("info")):(p(`Found ${j.length} employee(s)`),v("success"))}catch(e){console.error("Error fetching employees:",e),p("Error loading employees: "+e.message),v("danger")}finally{Ne(!1)}},Be=async e=>{if(0===z.length)return p("Please select at least one employee"),void v("warning");fe(!0);let s=0,i=0;try{const n=localStorage.getItem("token");for(const t of z)try{let a={};if(t.employee_data)try{a="string"===typeof t.employee_data?JSON.parse(t.employee_data):t.employee_data}catch(l){console.error("Error parsing employee_data:",l)}(await fetch("http://localhost:5000/api/meals/preference",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({employeeId:t.employee_id,employeeName:t.employee_name,email:a.email||t.email||"",preference:e,divisionId:t.division_code||t.division_id,divisionName:t.division_name,sectionId:t.section_code||t.section_id,sectionName:t.section_name,subsectionId:t.sub_section_id||t.subsection_id,subsectionName:t.sub_hie_name||t.subsection_name,allowanceAmount:"money"===e?500:0})})).ok?s++:i++}catch(a){console.error("Error transferring employee:",t,a),i++}s>0?(p(`\u2705 Successfully transferred ${s} employee(s) to ${"meal"===e?"Meal Package":"Money Allowance"}${i>0?`, ${i} failed`:""}`),v(i>0?"warning":"success"),H([]),await $e()):(p("Failed to transfer employees"),v("danger"))}catch(a){console.error("Error in transfer process:",a),p("Error transferring employees"),v("danger")}finally{fe(!1)}};return(0,t.jsxs)("div",{className:"meal-management",children:[(0,t.jsx)(n.A,{title:f("mealManagementTitle"),subtitle:"Manage meal bookings and employee preferences",icon:"bi-cup-hot-fill",onBack:s}),g&&(0,t.jsxs)("div",{className:`alert alert-${"success"===b?"success":"warning"===b?"warning":"danger"} alert-dismissible fade show`,style:{position:"sticky",top:"10px",zIndex:1050,boxShadow:"0 4px 6px rgba(0,0,0,0.1)",fontSize:"1.1rem",fontWeight:"500"},children:[(0,t.jsx)("i",{className:`bi bi-${"success"===b?"check-circle-fill":"warning"===b?"exclamation-triangle-fill":"x-circle-fill"} me-2`}),(0,t.jsx)("strong",{children:"success"===b?"Success!":"warning"===b?"Warning!":"Error!"})," ",g,(0,t.jsx)("button",{type:"button",className:"btn-close",onClick:()=>p("")})]}),(0,t.jsxs)("div",{className:"meal-container",children:[(0,t.jsxs)("div",{className:"row justify-content-center",children:[(0,t.jsx)("div",{className:"col-lg-6 col-md-8",children:(0,t.jsxs)("div",{className:"meal-card",children:[(0,t.jsx)("div",{className:"meal-card-header",children:(0,t.jsx)("h4",{className:"mb-0",children:"\ud83d\udccb Book New Meal"})}),(0,t.jsx)("div",{className:"card-body p-4",children:(0,t.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),u(!0),p("");try{const e=localStorage.getItem("token"),s=i.find(e=>e.division_id===h.divisionId),l=c.find(e=>e.section_id===h.sectionId),a={divisionId:h.divisionId,divisionName:(null===s||void 0===s?void 0:s.name)||(null===s||void 0===s?void 0:s.division_name)||"",sectionId:h.sectionId,sectionName:(null===l||void 0===l?void 0:l.name)||(null===l||void 0===l?void 0:l.section_name)||"",mealDate:h.mealDate,mealType:h.mealType,quantity:parseInt(h.quantity),specialRequirements:h.specialRequirements},n=await fetch("http://localhost:5000/api/meals/book",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(a)}),t=await n.json();n.ok&&t.success?(p(f("mealBookingCreated")),v("success"),x({divisionId:"",sectionId:"",mealDate:(new Date).toISOString().split("T")[0],mealType:"",quantity:1,specialRequirements:""}),Ce(),setTimeout(()=>{p("")},3e3)):(p(t.message||"Error creating meal booking"),v("error"))}catch(s){console.error("Meal booking error:",s),p(f("mealBookingNetworkError")),v("error")}finally{u(!1)}},children:[(0,t.jsxs)("div",{className:"meal-form-group",children:[(0,t.jsx)("label",{className:"meal-form-label",children:"Division"}),(0,t.jsxs)("select",{className:"form-select meal-form-control",value:h.divisionId,onChange:e=>x(s=>({...s,divisionId:e.target.value})),required:!0,children:[(0,t.jsx)("option",{value:"",children:f("selectDivision")}),i.map(e=>(0,t.jsx)("option",{value:e.division_id,children:e.division_name},e.division_id))]})]}),(0,t.jsxs)("div",{className:"meal-form-group",children:[(0,t.jsx)("label",{className:"meal-form-label",children:"Section"}),(0,t.jsxs)("select",{className:"form-select meal-form-control",value:h.sectionId,onChange:e=>x(s=>({...s,sectionId:e.target.value})),required:!0,children:[(0,t.jsx)("option",{value:"",children:f("selectSection")}),c.map(e=>(0,t.jsx)("option",{value:e.section_id,children:k(e.section_name)},e.section_id))]})]}),(0,t.jsxs)("div",{className:"meal-form-group",children:[(0,t.jsx)("label",{className:"meal-form-label",children:"Meal Date"}),(0,t.jsx)("input",{type:"date",className:"form-control meal-form-control",value:h.mealDate,onChange:e=>x(s=>({...s,mealDate:e.target.value})),min:(new Date).toISOString().split("T")[0],required:!0})]}),(0,t.jsxs)("div",{className:"meal-form-group",children:[(0,t.jsx)("label",{className:"meal-form-label",children:"Meal Type"}),(0,t.jsxs)("select",{className:"form-select meal-form-control",value:h.mealType,onChange:e=>x(s=>({...s,mealType:e.target.value})),required:!0,children:[(0,t.jsx)("option",{value:"",children:f("selectMealType")}),(0,t.jsx)("option",{value:"breakfast",children:f("mealTypeBreakfast")}),(0,t.jsx)("option",{value:"lunch",children:f("mealTypeLunch")}),(0,t.jsx)("option",{value:"dinner",children:f("mealTypeDinner")}),(0,t.jsx)("option",{value:"snack",children:f("mealTypeSnack")})]})]}),(0,t.jsxs)("div",{className:"meal-form-group",children:[(0,t.jsx)("label",{className:"meal-form-label",children:"Expected Quantity"}),(0,t.jsx)("input",{type:"number",className:"form-control meal-form-control",value:h.quantity,onChange:e=>x(s=>({...s,quantity:e.target.value})),min:"1",max:"500",required:!0})]}),(0,t.jsxs)("div",{className:"meal-form-group",children:[(0,t.jsx)("label",{className:"meal-form-label",children:"Special Requirements"}),(0,t.jsx)("textarea",{className:"form-control meal-form-control",rows:"3",value:h.specialRequirements,onChange:e=>x(s=>({...s,specialRequirements:e.target.value})),placeholder:f("specialRequirementsPlaceholder")})]}),(0,t.jsx)("button",{type:"submit",className:"btn meal-btn meal-btn-primary w-100",disabled:j,children:j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-arrow-clockwise spin"})," ",f("bookingInProgress")]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-utensils"})," Book Meal"]})})]})})]})}),(0,t.jsxs)("div",{className:"col-lg-3 col-md-4",children:[(0,t.jsxs)("div",{className:"meal-stats-card",children:[(0,t.jsx)("div",{className:"meal-stats-number",children:N}),(0,t.jsx)("div",{className:"meal-stats-label",children:f("todaysBookingsLabel")})]}),(0,t.jsxs)("div",{className:"info-card",children:[(0,t.jsx)("div",{className:"info-card-header",children:(0,t.jsx)("h5",{className:"mb-0",children:"\u2139\ufe0f Booking Information"})}),(0,t.jsx)("div",{className:"info-card-body",children:(0,t.jsxs)("ul",{className:"info-list",children:[(0,t.jsxs)("li",{children:["\ud83d\udcc5 ",f("bookingInfo_line1")]}),(0,t.jsxs)("li",{children:["\ud83d\udd50 ",f("bookingInfo_line2")]}),(0,t.jsxs)("li",{children:["\ud83c\udf7d\ufe0f ",f("bookingInfo_line3")]}),(0,t.jsxs)("li",{children:["\u26a0\ufe0f ",f("bookingInfo_line4")]}),(0,t.jsxs)("li",{children:["\ud83d\udccb ",f("bookingInfo_line5")]})]})})]}),(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("button",{className:"btn btn-primary w-100 mb-2",onClick:async()=>{w(!0),O(!1);try{const e=localStorage.getItem("token"),s=(new Date).toISOString().split("T")[0],i=await fetch("http://localhost:5000/api/meals/bookings/today",{method:"GET",headers:{Authorization:`Bearer ${e}`}}),l=await i.json();if(i.ok&&l.success){const i=l.data||[];if(0===i.length)return p("No bookings found for today"),v("error"),w(!1),void setTimeout(()=>p(""),3e3);const a=await fetch("http://localhost:5000/api/divisions/hris",{headers:{Authorization:`Bearer ${e}`}}),n=await a.json(),t={};(Array.isArray(n)?n:n.data||[]).forEach(e=>{const s=e._id||e.id||e.DIVISION_ID||e.code;t[s]=e.name||e.DIVISION_NAME||e.hie_name||"Unknown"}),M({bookings:i,date:s,type:"bookings",divisionsMap:t}),C(!0)}else p(l.message||"Error generating report"),v("error")}catch(e){console.error("Generate report error:",e),p("Network error occurred while generating report"),v("error")}finally{w(!1)}},disabled:E,children:E?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-arrow-clockwise spin"})," Generating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-file-earmark-text"})," Generate Today's Bookings"]})}),(0,t.jsx)("button",{className:"btn btn-success w-100 mb-2",onClick:async()=>{w(!0),C(!1);try{const e=localStorage.getItem("token"),s=(new Date).toISOString().split("T")[0],i=await fetch("http://localhost:5000/api/meals/bookings/today",{method:"GET",headers:{Authorization:`Bearer ${e}`}}),l=await i.json();if(i.ok&&l.success){const e=l.data||[];if(0===e.length)return p("No bookings found for today"),v("error"),w(!1),void setTimeout(()=>p(""),3e3);const i=e.reduce((e,s)=>{const i=s.mealType||"Unknown";return e[i]||(e[i]={count:0,quantity:0}),e[i].count+=1,e[i].quantity+=s.quantity||1,e},{});M({mealTypeCounts:i,date:s,type:"count",bookings:e}),O(!0)}else p(l.message||"Error generating report"),v("error")}catch(e){console.error("Generate count report error:",e),p("Network error occurred while generating report"),v("error")}finally{w(!1)}},disabled:E,children:E?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-arrow-clockwise spin"})," Generating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-bar-chart"})," Generate Meal Count Report"]})}),(0,t.jsxs)("button",{className:"btn btn-warning w-100 mb-2",onClick:()=>B(!0),children:[(0,t.jsx)("i",{className:"bi bi-gear"})," Set Meal Preference"]}),(0,t.jsxs)("button",{className:"btn btn-info w-100",onClick:()=>Se(!Ie),children:[(0,t.jsx)("i",{className:"bi bi-people"})," ",Ie?"Hide":"Show"," Employee Lists"]})]})]})]}),Ie&&(0,t.jsx)("div",{className:"row mt-4",children:(0,t.jsx)("div",{className:"col-12",children:(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header bg-info text-white",children:(0,t.jsxs)("h4",{className:"mb-0",children:[(0,t.jsx)("i",{className:"bi bi-people-fill"})," Employee Meal Preferences"]})}),(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"alert alert-info mb-4",children:[(0,t.jsx)("i",{className:"bi bi-info-circle me-2"}),(0,t.jsx)("strong",{children:"How to use:"})," Select Division and Section, click Search to find unassigned employees, select employees, then transfer them to Meal Package or Money Allowance."]}),(0,t.jsxs)("div",{className:"row mb-4",children:[(0,t.jsxs)("div",{className:"col-md-6",children:[(0,t.jsxs)("label",{className:"form-label fw-bold",children:["Division ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsxs)("select",{className:"form-select",value:oe,onChange:e=>{console.log("Division selected:",e.target.value);const s=i.find(s=>s.division_id===e.target.value);console.log("Division object:",s);const l=d.filter(s=>String(s.division_id||s.divisionId||s.DIVISION_ID||"")===String(e.target.value));console.log(`Found ${l.length} sections for this division`),ce(e.target.value),de("all"),he("all")},children:[(0,t.jsx)("option",{value:"all",children:"All Divisions"}),i.map(e=>(0,t.jsx)("option",{value:e.division_id,children:e.division_name},e.division_id))]})]}),(0,t.jsxs)("div",{className:"col-md-6",children:[(0,t.jsxs)("label",{className:"form-label fw-bold",children:["Section ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsxs)("select",{className:"form-select",value:re,onChange:e=>{console.log("Section selected:",e.target.value),de(e.target.value),he("all")},disabled:"all"===oe,children:[(0,t.jsx)("option",{value:"all",children:"Select Section"}),d.filter(e=>{if("all"===oe)return!0;return String(e.division_id||e.divisionId||e.DIVISION_ID||"")===String(oe)}).map(e=>(0,t.jsx)("option",{value:e.section_id,children:e.section_name},e.section_id))]})]})]}),(0,t.jsx)("div",{className:"row mb-4",children:(0,t.jsx)("div",{className:"col-12",children:(0,t.jsx)("button",{className:"btn btn-primary btn-lg w-100",onClick:$e,disabled:ve||"all"===oe||"all"===re,children:ve?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Searching..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-search me-2"}),"Search Employees"]})})})}),(0,t.jsxs)("ul",{className:"nav nav-tabs mb-3",children:[pe.length>0&&(0,t.jsx)("li",{className:"nav-item",children:(0,t.jsxs)("button",{className:"nav-link "+("search"===_e?"active":""),onClick:()=>ke("search"),children:[(0,t.jsx)("i",{className:"bi bi-people"})," Search Results (",pe.length,")"]})}),(0,t.jsx)("li",{className:"nav-item",children:(0,t.jsxs)("button",{className:"nav-link "+("meal"===_e?"active":""),onClick:()=>{ke("meal"),(async()=>{try{const e=localStorage.getItem("token");let s="http://localhost:5000/api/meals/employees/meal-package?";"all"!==oe&&(s+=`divisionId=${oe}&`),"all"!==re&&(s+=`sectionId=${re}&`),"all"!==me&&(s+=`subsectionId=${me}&`);const i=await fetch(s,{headers:{Authorization:`Bearer ${e}`}}),l=await i.json();i.ok&&l.success&&je(l.data||[])}catch(e){console.error("Error fetching meal package employees:",e)}})()},children:[(0,t.jsx)("i",{className:"bi bi-egg-fried"})," Meal Package (",xe.length,")"]})}),(0,t.jsx)("li",{className:"nav-item",children:(0,t.jsxs)("button",{className:"nav-link "+("money"===_e?"active":""),onClick:()=>{ke("money"),(async()=>{try{const e=localStorage.getItem("token");let s="http://localhost:5000/api/meals/employees/money-allowance?";"all"!==oe&&(s+=`divisionId=${oe}&`),"all"!==re&&(s+=`sectionId=${re}&`),"all"!==me&&(s+=`subsectionId=${me}&`);const i=await fetch(s,{headers:{Authorization:`Bearer ${e}`}}),l=await i.json();i.ok&&l.success&&ge(l.data||[])}catch(e){console.error("Error fetching money allowance employees:",e)}})()},children:[(0,t.jsx)("i",{className:"bi bi-cash-coin"})," Money Allowance (",ue.length,")"]})})]}),"search"===_e&&(0,t.jsx)("div",{children:pe.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"row mb-3",children:[(0,t.jsx)("div",{className:"col-md-6",children:(0,t.jsxs)("button",{className:"btn btn-primary w-100",onClick:()=>Be("meal"),disabled:0===z.length||ye,children:[ye?(0,t.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}):(0,t.jsx)("i",{className:"bi bi-egg-fried me-2"}),"Transfer to Meal Package (",z.length,")"]})}),(0,t.jsx)("div",{className:"col-md-6",children:(0,t.jsxs)("button",{className:"btn btn-success w-100",onClick:()=>Be("money"),disabled:0===z.length||ye,children:[ye?(0,t.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}):(0,t.jsx)("i",{className:"bi bi-cash-coin me-2"}),"Transfer to Money Allowance (",z.length,")"]})})]}),(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-striped table-hover",children:[(0,t.jsx)("thead",{className:"table-primary",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{style:{width:"50px"},children:(0,t.jsx)("input",{type:"checkbox",className:"form-check-input",checked:z.length===pe.length&&pe.length>0,onChange:()=>Me(pe)})}),(0,t.jsx)("th",{children:"#"}),(0,t.jsx)("th",{children:"Employee ID"}),(0,t.jsx)("th",{children:"Employee Name"})]})}),(0,t.jsx)("tbody",{children:pe.map((e,s)=>{const i=z.some(s=>s.employee_id===e.employee_id);return(0,t.jsxs)("tr",{style:{cursor:"pointer"},onClick:()=>Te(e),className:i?"table-active":"",children:[(0,t.jsx)("td",{onClick:e=>e.stopPropagation(),children:(0,t.jsx)("input",{type:"checkbox",className:"form-check-input",checked:i,onChange:()=>Te(e)})}),(0,t.jsx)("td",{children:s+1}),(0,t.jsx)("td",{children:(0,t.jsx)("strong",{children:e.employee_id})}),(0,t.jsx)("td",{children:e.employee_name})]},e.employee_id)})})]})})]})}),"meal"===_e&&(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-striped table-hover",children:[(0,t.jsx)("thead",{className:"table-primary",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"#"}),(0,t.jsx)("th",{children:"Employee ID"}),(0,t.jsx)("th",{children:"Employee Name"})]})}),(0,t.jsx)("tbody",{children:xe.length>0?xe.map((e,s)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:s+1}),(0,t.jsx)("td",{children:(0,t.jsx)("strong",{children:e.employee_id})}),(0,t.jsx)("td",{children:e.employee_name})]},e.id)):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:"3",className:"text-center text-muted",children:"No employees in meal package"})})})]})}),"money"===_e&&(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-striped table-hover",children:[(0,t.jsx)("thead",{className:"table-success",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"#"}),(0,t.jsx)("th",{children:"Employee ID"}),(0,t.jsx)("th",{children:"Employee Name"}),(0,t.jsx)("th",{children:"Allowance"})]})}),(0,t.jsx)("tbody",{children:ue.length>0?ue.map((e,s)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:s+1}),(0,t.jsx)("td",{children:(0,t.jsx)("strong",{children:e.employee_id})}),(0,t.jsx)("td",{children:e.employee_name}),(0,t.jsx)("td",{children:(0,t.jsxs)("strong",{children:["Rs. ",parseFloat(e.allowance_amount).toFixed(2)]})})]},e.id)):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:"4",className:"text-center text-muted",children:"No employees with money allowance"})})})]})})]})]})})}),D&&T&&"bookings"===T.type&&(0,t.jsx)("div",{className:"row mt-4",children:(0,t.jsx)("div",{className:"col-12",children:(0,t.jsxs)("div",{className:"card",children:[(0,t.jsxs)("div",{className:"card-header bg-primary text-white d-flex justify-content-between align-items-center",children:[(0,t.jsx)("h4",{className:"mb-0",children:"\ud83d\udccb Today's Meal Bookings Report"}),(0,t.jsx)("button",{className:"btn btn-sm btn-light",onClick:()=>C(!1),children:"\u2715 Close"})]}),(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"row mb-3",children:[(0,t.jsx)("div",{className:"col-md-3 col-sm-6 mb-2",children:(0,t.jsxs)("div",{className:"alert alert-info mb-0",children:[(0,t.jsx)("strong",{children:"\ud83d\udcc5 Date:"}),(0,t.jsx)("br",{}),new Date(T.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})}),(0,t.jsx)("div",{className:"col-md-3 col-sm-6 mb-2",children:(0,t.jsxs)("div",{className:"alert alert-success mb-0",children:[(0,t.jsx)("strong",{children:"\ud83d\udcca Total Bookings:"}),(0,t.jsx)("br",{}),(0,t.jsx)("h3",{className:"mb-0",children:T.bookings.length})]})}),(0,t.jsx)("div",{className:"col-md-3 col-sm-6 mb-2",children:(0,t.jsxs)("div",{className:"alert alert-warning mb-0",children:[(0,t.jsx)("strong",{children:"\ud83c\udf7d\ufe0f Total Meals:"}),(0,t.jsx)("br",{}),(0,t.jsx)("h3",{className:"mb-0",children:T.bookings.reduce((e,s)=>e+(s.quantity||0),0)})]})}),(0,t.jsx)("div",{className:"col-md-3 col-sm-6 mb-2",children:(0,t.jsxs)("div",{className:"alert alert-primary mb-0",children:[(0,t.jsx)("strong",{children:"\ud83d\udd50 Generated At:"}),(0,t.jsx)("br",{}),(new Date).toLocaleTimeString()]})})]}),(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-striped table-hover",children:[(0,t.jsx)("thead",{className:"table-primary",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"#"}),(0,t.jsx)("th",{children:"Employee ID"}),(0,t.jsx)("th",{children:"Employee Name"}),(0,t.jsx)("th",{children:"Email"}),(0,t.jsx)("th",{children:"Division"}),(0,t.jsx)("th",{children:"Meal Type"}),(0,t.jsx)("th",{children:"Quantity"}),(0,t.jsx)("th",{children:"Status"}),(0,t.jsx)("th",{children:"Special Requirements"}),(0,t.jsx)("th",{children:"Booked At"})]})}),(0,t.jsx)("tbody",{children:T.bookings.map((e,s)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:s+1}),(0,t.jsx)("td",{children:e.employeeId||"N/A"}),(0,t.jsx)("td",{children:(0,t.jsx)("strong",{children:e.employeeName||"Unknown"})}),(0,t.jsx)("td",{children:e.email||"N/A"}),(0,t.jsx)("td",{children:T.divisionsMap[e.divisionId]||e.divisionId||"N/A"}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"badge bg-info text-capitalize",children:e.mealType||"N/A"})}),(0,t.jsx)("td",{children:(0,t.jsx)("strong",{children:e.quantity||1})}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"badge bg-"+("confirmed"===e.status?"success":"warning"),children:e.status||"pending"})}),(0,t.jsx)("td",{children:e.specialRequirements||"-"}),(0,t.jsx)("td",{children:new Date(e.createdAt).toLocaleString()})]},e.id||s))})]})})]})]})})}),A&&T&&"count"===T.type&&(0,t.jsx)("div",{className:"row mt-4",children:(0,t.jsx)("div",{className:"col-12",children:(0,t.jsxs)("div",{className:"card",children:[(0,t.jsxs)("div",{className:"card-header bg-success text-white d-flex justify-content-between align-items-center",children:[(0,t.jsx)("h4",{className:"mb-0",children:"\ud83d\udcca Meal Count Report"}),(0,t.jsx)("button",{className:"btn btn-sm btn-light",onClick:()=>O(!1),children:"\u2715 Close"})]}),(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"row mb-3",children:[(0,t.jsx)("div",{className:"col-md-3 col-sm-6 mb-2",children:(0,t.jsxs)("div",{className:"alert alert-info mb-0",children:[(0,t.jsx)("strong",{children:"\ud83d\udcc5 Date:"}),(0,t.jsx)("br",{}),new Date(T.date).toLocaleDateString()]})}),(0,t.jsx)("div",{className:"col-md-3 col-sm-6 mb-2",children:(0,t.jsxs)("div",{className:"alert alert-success mb-0",children:[(0,t.jsx)("strong",{children:"\ud83d\udccb Total Bookings:"}),(0,t.jsx)("br",{}),(0,t.jsx)("h3",{className:"mb-0",children:T.bookings.length})]})}),(0,t.jsx)("div",{className:"col-md-3 col-sm-6 mb-2",children:(0,t.jsxs)("div",{className:"alert alert-warning mb-0",children:[(0,t.jsx)("strong",{children:"\ud83c\udf7d\ufe0f Total Meals:"}),(0,t.jsx)("br",{}),(0,t.jsx)("h3",{className:"mb-0",children:Object.values(T.mealTypeCounts).reduce((e,s)=>e+s.quantity,0)})]})}),(0,t.jsx)("div",{className:"col-md-3 col-sm-6 mb-2",children:(0,t.jsxs)("div",{className:"alert alert-primary mb-0",children:[(0,t.jsx)("strong",{children:"\ud83d\udd50 Generated At:"}),(0,t.jsx)("br",{}),(new Date).toLocaleTimeString()]})})]}),(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-striped table-hover",children:[(0,t.jsx)("thead",{className:"table-success",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Meal Type"}),(0,t.jsx)("th",{children:"Number of Bookings"}),(0,t.jsx)("th",{children:"Total Quantity"})]})}),(0,t.jsxs)("tbody",{children:[Object.entries(T.mealTypeCounts).map(e=>{let[s,i]=e;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"text-capitalize",children:(0,t.jsxs)("strong",{children:["\ud83c\udf7d\ufe0f ",s]})}),(0,t.jsx)("td",{children:(0,t.jsx)("h5",{className:"text-success mb-0",children:i.count})}),(0,t.jsx)("td",{children:(0,t.jsx)("h5",{className:"text-success mb-0",children:i.quantity})})]},s)}),(0,t.jsxs)("tr",{className:"table-success fw-bold",children:[(0,t.jsx)("td",{children:(0,t.jsx)("strong",{children:"\ud83d\udcca TOTAL"})}),(0,t.jsx)("td",{children:(0,t.jsx)("strong",{children:Object.values(T.mealTypeCounts).reduce((e,s)=>e+s.count,0)})}),(0,t.jsx)("td",{children:(0,t.jsx)("strong",{children:Object.values(T.mealTypeCounts).reduce((e,s)=>e+s.quantity,0)})})]})]})]})})]})]})})}),$&&(0,t.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,t.jsx)("div",{className:"modal-dialog modal-xl",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header bg-warning",children:[(0,t.jsxs)("h5",{className:"modal-title",children:[(0,t.jsx)("i",{className:"bi bi-gear"})," Set Employee Meal Preference"]}),(0,t.jsx)("button",{type:"button",className:"btn-close",onClick:()=>{B(!1),P(""),R([]),V([]),H([]),J("all"),W("all"),X("all"),G("")}})]}),(0,t.jsxs)("div",{className:"modal-body",children:[(0,t.jsxs)("div",{className:"alert alert-info",children:[(0,t.jsx)("i",{className:"bi bi-info-circle"})," Search employees by ID or name from HRIS, then filter and select multiple employees to assign meal preferences"]}),(0,t.jsx)("div",{className:"row mb-3",children:(0,t.jsxs)("div",{className:"col-md-12",children:[(0,t.jsx)("label",{className:"form-label fw-bold",children:"Search Employee (ID or Name)"}),(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsx)("input",{type:"text",className:"form-control",placeholder:"Enter employee ID or name (min 2 characters)...",value:F,onChange:e=>P(e.target.value),onKeyPress:e=>"Enter"===e.key&&Ae()}),(0,t.jsx)("button",{className:"btn btn-primary",onClick:Ae,disabled:le,children:le?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Searching..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-search"})," Search HRIS"]})})]})]})}),0===q.length&&!le&&(0,t.jsxs)("div",{className:"alert alert-light border text-center py-4",children:[(0,t.jsx)("i",{className:"bi bi-search fs-1 text-muted d-block mb-3"}),(0,t.jsx)("h5",{className:"text-muted",children:"Search for employees to get started"}),(0,t.jsx)("p",{className:"text-muted mb-0",children:'Enter an employee ID or name above and click "Search HRIS"'})]}),q.length>0&&(0,t.jsxs)("div",{className:"row mb-3",children:[(0,t.jsxs)("div",{className:"col-md-4",children:[(0,t.jsx)("label",{className:"form-label fw-bold",children:"Filter by Division"}),(0,t.jsxs)("select",{className:"form-select",value:Y,onChange:e=>J(e.target.value),children:[(0,t.jsx)("option",{value:"all",children:"All Divisions"}),i.map(e=>(0,t.jsx)("option",{value:e.division_id,children:e.division_name},e.division_id))]})]}),(0,t.jsxs)("div",{className:"col-md-4",children:[(0,t.jsx)("label",{className:"form-label fw-bold",children:"Filter by Section"}),(0,t.jsxs)("select",{className:"form-select",value:Q,onChange:e=>W(e.target.value),disabled:"all"===Y,children:[(0,t.jsx)("option",{value:"all",children:"All Sections"}),Z.map(e=>(0,t.jsx)("option",{value:e.section_id,children:e.section_name},e.section_id))]})]}),(0,t.jsxs)("div",{className:"col-md-4",children:[(0,t.jsx)("label",{className:"form-label fw-bold",children:"Filter by Sub-Section"}),(0,t.jsxs)("select",{className:"form-select",value:K,onChange:e=>X(e.target.value),disabled:"all"===Q,children:[(0,t.jsx)("option",{value:"all",children:"All Sub-Sections"}),se.map(e=>(0,t.jsx)("option",{value:e.id,children:e.sub_name},e.id))]})]})]}),L.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,t.jsxs)("label",{className:"form-label fw-bold mb-0",children:["Select Employees (",z.length," of ",L.length," selected)"]}),(0,t.jsx)("button",{className:"btn btn-sm btn-outline-primary",onClick:Me,children:z.length===L.length&&L.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-square"})," Deselect All"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-check-square"})," Select All"]})})]}),(0,t.jsx)("div",{className:"table-responsive",style:{maxHeight:"300px",overflowY:"auto"},children:(0,t.jsxs)("table",{className:"table table-hover table-sm",children:[(0,t.jsx)("thead",{className:"table-light sticky-top",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{style:{width:"50px"},children:(0,t.jsx)("input",{type:"checkbox",className:"form-check-input",checked:z.length===L.length&&L.length>0,onChange:Me})}),(0,t.jsx)("th",{children:"ID"}),(0,t.jsx)("th",{children:"Name"}),(0,t.jsx)("th",{children:"Division"}),(0,t.jsx)("th",{children:"Section"}),(0,t.jsx)("th",{children:"Sub-Section"})]})}),(0,t.jsx)("tbody",{children:L.map(e=>{const s=e.employee_id||e.id||e.EMPLOYEE_ID,i=z.some(e=>(e.employee_id||e.id||e.EMPLOYEE_ID)===s);return(0,t.jsxs)("tr",{style:{cursor:"pointer"},onClick:()=>Te(e),className:i?"table-active":"",children:[(0,t.jsx)("td",{children:(0,t.jsx)("input",{type:"checkbox",className:"form-check-input",checked:i,onChange:()=>Te(e)})}),(0,t.jsx)("td",{children:(0,t.jsx)("strong",{children:s})}),(0,t.jsx)("td",{children:e.employee_name||e.name||e.EMPLOYEE_NAME}),(0,t.jsx)("td",{children:e.division_name||e.divisionName||e.DIVISION_NAME||"N/A"}),(0,t.jsx)("td",{children:e.section_name||e.sectionName||e.SECTION_NAME||"N/A"}),(0,t.jsx)("td",{children:e.subsection_name||e.subsectionName||e.SUBSECTION_NAME||"N/A"})]},s)})})]})})]}),q.length>0&&0===L.length&&(0,t.jsxs)("div",{className:"alert alert-warning",children:[(0,t.jsx)("i",{className:"bi bi-exclamation-triangle"})," No employees match the selected filters"]}),z.length>0&&(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsxs)("label",{className:"form-label fw-bold",children:["Select Meal Preference for ",z.length," Employee(s)"]}),(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col-md-6",children:(0,t.jsx)("div",{className:"card "+("meal"===U?"border-primary border-3":""),style:{cursor:"pointer"},onClick:()=>G("meal"),children:(0,t.jsxs)("div",{className:"card-body text-center",children:[(0,t.jsx)("i",{className:"bi bi-egg-fried fs-1 text-primary"}),(0,t.jsx)("h5",{className:"mt-2",children:"Physical Meal Package"}),(0,t.jsx)("p",{className:"text-muted small",children:"Employees receive actual meals from cafeteria"}),"meal"===U&&(0,t.jsx)("i",{className:"bi bi-check-circle-fill text-primary fs-4"})]})})}),(0,t.jsx)("div",{className:"col-md-6",children:(0,t.jsx)("div",{className:"card "+("money"===U?"border-success border-3":""),style:{cursor:"pointer"},onClick:()=>G("money"),children:(0,t.jsxs)("div",{className:"card-body text-center",children:[(0,t.jsx)("i",{className:"bi bi-cash-coin fs-1 text-success"}),(0,t.jsx)("h5",{className:"mt-2",children:"Money Allowance"}),(0,t.jsx)("p",{className:"text-muted small",children:"Employees receive money instead of meals"}),"money"===U&&(0,t.jsx)("i",{className:"bi bi-check-circle-fill text-success fs-4"})]})})})]})]})]}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>{B(!1),P(""),R([]),V([]),H([]),J("all"),W("all"),X("all"),G("")},children:"Cancel"}),(0,t.jsx)("button",{type:"button",className:"btn btn-primary",onClick:async()=>{if(0===z.length)return p("Please select at least one employee"),void v("warning");if(!U)return p("Please select meal preference type"),void v("warning");te(!0);try{let s=0,i=0;for(const l of z)try{(await fetch("http://localhost:5000/api/meals/preference",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({employeeId:l.employee_id||l.id||l.EMPLOYEE_ID,employeeName:l.employee_name||l.name||l.EMPLOYEE_NAME,email:l.email||l.EMAIL||"",divisionId:l.division_id||l.divisionId||l.DIVISION_ID,divisionName:l.division_name||l.divisionName||l.DIVISION_NAME,sectionId:l.section_id||l.sectionId||l.SECTION_ID,sectionName:l.section_name||l.sectionName||l.SECTION_NAME,subsectionId:l.subsection_id||l.subsectionId||l.SUBSECTION_ID||null,subsectionName:l.subsection_name||l.subsectionName||l.SUBSECTION_NAME||null,preference:U,allowanceAmount:"money"===U?500:0})})).ok?s++:i++}catch(e){console.error("Error assigning preference for employee:",l,e),i++}s>0?(p(`Successfully assigned preferences for ${s} employee(s)${i>0?`, ${i} failed`:""}`),v(i>0?"warning":"success"),H([]),R([]),V([]),P(""),J("all"),W("all"),X("all"),B(!1),$e()):(p("Failed to assign preferences"),v("danger"))}catch(e){console.error("Error submitting batch preferences:",e),p("Error submitting preferences"),v("danger")}finally{te(!1)}},disabled:0===z.length||!U||ne,children:ne?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-check-circle"})," Save Preferences (",z.length," employees)"]})})]})]})})})]})]})}}}]);
//# sourceMappingURL=366.99713c5a.chunk.js.map