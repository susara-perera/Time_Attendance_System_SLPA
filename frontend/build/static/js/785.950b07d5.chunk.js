"use strict";(self.webpackChunktime_attendance_frontend=self.webpackChunktime_attendance_frontend||[]).push([[785],{83:(e,s,a)=>{a.d(s,{A:()=>t});a(43);var l=a(769),o=a(579);const t=e=>{let{title:s,subtitle:a,icon:t="bi-folder",actions:i,onBack:r}=e;return(0,o.jsxs)(o.Fragment,{children:[r&&(0,o.jsxs)("button",{className:"back-arrow-btn",onClick:r,title:"Back to Dashboard",style:{marginBottom:"12px",background:"transparent",color:"#0f172a",border:"1px solid rgba(15,23,42,0.08)",width:"auto",padding:"8px 12px"},children:[(0,o.jsx)("i",{className:"bi bi-arrow-left"}),"\xa0",(0,o.jsx)("span",{style:{fontWeight:600},children:"Back"})]}),(0,o.jsxs)("div",{className:"page-header-banner",children:[(0,o.jsxs)("div",{className:"page-header-content",children:[(0,o.jsxs)("div",{className:"page-header-left",children:[(0,o.jsx)("div",{className:"page-header-icon",children:(0,o.jsx)("i",{className:`bi ${t}`})}),(0,o.jsxs)("div",{className:"page-header-text",children:[(0,o.jsx)("h1",{children:s}),a&&(0,o.jsx)("p",{children:a})]})]}),(0,o.jsxs)("div",{className:"page-header-right",children:[i&&(0,o.jsx)("div",{className:"page-header-actions",children:i}),(0,o.jsx)("div",{className:"page-header-logo",children:(0,o.jsx)("img",{src:l,alt:"Company Logo"})})]})]}),(0,o.jsxs)("div",{className:"page-header-decoration",children:[(0,o.jsx)("div",{className:"decoration-circle decoration-circle-1"}),(0,o.jsx)("div",{className:"decoration-circle decoration-circle-2"}),(0,o.jsx)("div",{className:"decoration-circle decoration-circle-3"})]})]})]})}},420:()=>{},785:(e,s,a)=>{a.r(s),a.d(s,{default:()=>r});var l=a(43),o=a(68),t=(a(420),a(83)),i=a(579);const r=e=>{let{onBack:s}=e;const{user:a,hasPermission:r}=(0,l.useContext)(o.c),[n,c]=(0,l.useState)([]),[d,m]=(0,l.useState)(!0),[p,x]=(0,l.useState)(!1),[h,u]=(0,l.useState)(!1),[b,g]=(0,l.useState)(!1),[j,f]=(0,l.useState)(!1),[N,y]=(0,l.useState)(""),[v,k]=(0,l.useState)(null),[w,S]=(0,l.useState)(null),[C,T]=(0,l.useState)(""),[R,D]=(0,l.useState)(""),[A,_]=(0,l.useState)(!1),[B,z]=(0,l.useState)(""),E="super_admin"===(null===a||void 0===a?void 0:a.role),$=()=>E||r("view_roles")||r("roles.read"),F=()=>E||r("create_role")||r("roles.create"),W=()=>E||r("update_role")||r("roles.update")||r("permission_management.manage_permission"),Y=()=>E||r("delete_role")||r("roles.delete"),I=e=>{z(e),f(!0),setTimeout(()=>{f(!1),z("")},3e3)};(0,l.useEffect)(()=>{(async()=>{try{m(!0);const e=localStorage.getItem("token"),s=await fetch("http://localhost:5000/api/roles",{headers:{...e?{Authorization:`Bearer ${e}`}:{}}});if(s.ok){const e=await s.json();console.log("Fetched roles:",e.data),c(e.data||[])}else console.error("Failed to fetch roles, status:",s.status),T("Failed to fetch roles"),D("error"),_(!0),setTimeout(()=>_(!1),4e3)}catch(e){console.error("Error fetching roles:",e),T("Error fetching roles"),D("error"),_(!0),setTimeout(()=>_(!1),4e3)}finally{m(!1)}})()},[]);return d?(0,i.jsx)("div",{className:"role-access-wrapper",children:(0,i.jsx)("div",{className:"loading-overlay",children:(0,i.jsx)("div",{className:"loading-spinner"})})}):(0,i.jsxs)("div",{className:"role-access-wrapper",children:[(0,i.jsxs)("div",{className:"geometric-background",children:[(0,i.jsx)("div",{className:"geometric-shape shape-1"}),(0,i.jsx)("div",{className:"geometric-shape shape-2"}),(0,i.jsx)("div",{className:"geometric-shape shape-3"}),(0,i.jsx)("div",{className:"geometric-shape shape-4"})]}),(0,i.jsxs)("div",{className:"container-fluid px-4",children:[(0,i.jsx)(t.A,{title:"Role Management",subtitle:"Define and manage user roles and access levels",icon:"bi-shield-lock",onBack:s,actions:$()?(0,i.jsxs)("button",{className:"btn-professional "+(F()?"btn-primary":"btn-secondary"),onClick:()=>{F()?x(!0):(T('You do not have permission to create roles. Contact a Super Admin for "roles.create" access.'),D("error"),_(!0),setTimeout(()=>_(!1),4e3))},title:F()?"Add New Role":"You need 'roles.create' permission to add roles",style:{padding:"10px 16px",fontSize:"14px",cursor:F()?"pointer":"not-allowed",opacity:F()?1:.6},children:[(0,i.jsx)("i",{className:"bi "+(F()?"bi-plus-circle":"bi-lock")}),"Add Role",!F()&&(0,i.jsx)("i",{className:"bi bi-exclamation-triangle ml-1",style:{fontSize:"12px"}})]}):null}),(0,i.jsx)("div",{className:"main-card",style:{marginTop:"20px"},children:(0,i.jsxs)("div",{className:"card-body-custom",children:[A&&C&&(0,i.jsxs)("div",{className:"toast-popup "+("success"===R?"toast-success":"toast-error"),children:[(0,i.jsx)("i",{className:`bi ${"success"===R?"bi-check-circle":"bi-exclamation-circle"} mr-2`}),C]}),!$()&&(0,i.jsxs)("div",{className:"alert alert-warning",children:[(0,i.jsx)("i",{className:"bi bi-lock-fill mr-2"}),'You do not have permission to view role management. Contact a Super Admin for "roles.read" access.']}),"            ",$()&&!F()&&!W()&&!Y()&&(0,i.jsxs)("div",{className:"alert alert-info",children:[(0,i.jsx)("i",{className:"bi bi-eye mr-2"}),"You have read-only access to role management. Contact a Super Admin for additional permissions."]}),$()&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:"professional-card",children:(0,i.jsx)("div",{className:"table-responsive",children:(0,i.jsxs)("table",{className:"professional-table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Role Name"}),(0,i.jsx)("th",{children:"Role Value"}),(0,i.jsx)("th",{children:"Created Date"}),(0,i.jsx)("th",{children:"Actions"})]})}),(0,i.jsx)("tbody",{children:0===n.length?(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:"4",className:"text-center",children:"No roles found"})}):n.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)("strong",{children:e.label})}),(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:e.value})}),(0,i.jsx)("td",{children:new Date(e.createdAt||Date.now()).toLocaleDateString()}),(0,i.jsx)("td",{children:$()?(0,i.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,i.jsxs)("button",{className:"btn-professional "+(W(),"btn-secondary"),onClick:()=>{W()?(e=>{k(e),y(e.label),u(!0)})(e):(T('You do not have permission to edit roles. Contact a Super Admin for "roles.update" access.'),D("error"),_(!0),setTimeout(()=>_(!1),4e3))},title:W()?"Edit Role":"You need 'roles.update' permission to edit roles",style:{padding:"6px 10px",fontSize:"12px",cursor:W()?"pointer":"not-allowed",opacity:W()?1:.6},children:[(0,i.jsx)("i",{className:"bi "+(W()?"bi-pencil":"bi-lock")}),"Edit",!W()&&(0,i.jsx)("i",{className:"bi bi-exclamation-triangle ml-1",style:{fontSize:"10px"}})]}),(0,i.jsxs)("button",{className:"btn-professional "+(Y()?"btn-danger":"btn-secondary"),onClick:s=>{s.preventDefault(),s.stopPropagation(),Y()?(console.log("Delete button clicked for role:",e),(e=>{console.log("Opening delete confirmation for role:",e),S(e),g(!0)})(e)):(T('You do not have permission to delete roles. Contact a Super Admin for "roles.delete" access.'),D("error"),_(!0),setTimeout(()=>_(!1),4e3))},title:Y()?"Delete Role":"You need 'roles.delete' permission to delete roles",style:{padding:"6px 10px",fontSize:"12px",cursor:Y()?"pointer":"not-allowed",opacity:Y()?1:.6},children:[(0,i.jsx)("i",{className:"bi "+(Y()?"bi-trash":"bi-lock")}),"Delete",!Y()&&(0,i.jsx)("i",{className:"bi bi-exclamation-triangle ml-1",style:{fontSize:"10px"}})]})]}):(0,i.jsxs)("span",{className:"text-muted",children:[(0,i.jsx)("i",{className:"bi bi-lock mr-1"}),"No access"]})})]},e._id))})]})})})})]})})]}),p&&(0,i.jsx)("div",{className:"modal-overlay",onClick:()=>x(!1),children:(0,i.jsxs)("div",{className:"modal-content professional-form",onClick:e=>e.stopPropagation(),style:{maxWidth:"420px"},children:[(0,i.jsxs)("div",{className:"modal-header",style:{borderBottom:"2px solid var(--gray-200)",paddingBottom:"12px",marginBottom:"16px"},children:[(0,i.jsxs)("h3",{style:{fontSize:"20px",fontWeight:"700",color:"var(--gray-900)",display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)("i",{className:"bi bi-plus-circle",style:{color:"var(--primary)"}}),"Add New Role"]}),(0,i.jsx)("button",{className:"modal-close btn-professional btn-danger",onClick:()=>x(!1),style:{padding:"6px 10px",fontSize:"14px"},children:(0,i.jsx)("i",{className:"bi bi-x"})})]}),(0,i.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const s=N.trim(),a=s.toLowerCase().replace(/\s+/g,"_");if(a)try{const e=localStorage.getItem("token"),l=await fetch("http://localhost:5000/api/roles",{method:"POST",headers:{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}},body:JSON.stringify({value:a,label:s})});if(l.ok){const e=(await l.json()).data;c(s=>[...s,e]),y(""),x(!1),I(`Role "${e.label}" has been successfully created!`),T(`Role "${e.label}" created successfully!`),D("success"),_(!0),setTimeout(()=>_(!1),4e3),window.dispatchEvent(new CustomEvent("roleAdded",{detail:{value:e.value,label:e.label}}))}else{const e=await l.json().catch(()=>({}));T(e.message||"Failed to create role"),D("error"),_(!0),setTimeout(()=>_(!1),4e3)}}catch(l){console.error("Error creating role:",l),T("Network error while creating role"),D("error"),_(!0),setTimeout(()=>_(!1),4e3)}},className:"modal-body",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{className:"form-label",children:"Role Name *"}),(0,i.jsx)("input",{type:"text",name:"roleName",className:"form-input",value:N,onChange:e=>y(e.target.value),placeholder:"e.g., Regional Manager",required:!0}),(0,i.jsx)("small",{className:"text-muted",children:"Only a name is required. We'll create an internal value automatically."})]}),(0,i.jsxs)("div",{className:"modal-footer",style:{borderTop:"2px solid var(--gray-200)",paddingTop:"12px",marginTop:"12px",display:"flex",gap:"12px",justifyContent:"flex-end"},children:[(0,i.jsx)("button",{type:"button",className:"btn-professional btn-secondary",onClick:()=>x(!1),children:"Cancel"}),(0,i.jsx)("button",{type:"submit",className:"btn-professional btn-success",children:"Add Role"})]})]})]})}),h&&(0,i.jsx)("div",{className:"modal-overlay",onClick:()=>u(!1),children:(0,i.jsxs)("div",{className:"modal-content professional-form",onClick:e=>e.stopPropagation(),style:{maxWidth:"420px"},children:[(0,i.jsxs)("div",{className:"modal-header",style:{borderBottom:"2px solid var(--gray-200)",paddingBottom:"12px",marginBottom:"16px"},children:[(0,i.jsxs)("h3",{style:{fontSize:"20px",fontWeight:"700",color:"var(--gray-900)",display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)("i",{className:"bi bi-pencil",style:{color:"var(--primary)"}}),"Edit Role"]}),(0,i.jsx)("button",{className:"modal-close btn-professional btn-danger",onClick:()=>u(!1),style:{padding:"6px 10px",fontSize:"14px"},children:(0,i.jsx)("i",{className:"bi bi-x"})})]}),(0,i.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const s=N.trim();if(s&&v)try{const e=localStorage.getItem("token"),a=await fetch(`http://localhost:5000/api/roles/${v._id}`,{method:"PUT",headers:{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}},body:JSON.stringify({label:s})});if(a.ok){const e=(await a.json()).data;c(s=>s.map(s=>s._id===v._id?e:s)),y(""),k(null),u(!1),I(`Role "${e.label}" has been successfully updated!`),T("Role updated successfully!"),D("success"),_(!0),setTimeout(()=>_(!1),4e3),window.dispatchEvent(new CustomEvent("roleUpdated",{detail:{value:e.value,label:e.label}}))}else{const e=await a.json().catch(()=>({}));T(e.message||"Failed to update role"),D("error"),_(!0),setTimeout(()=>_(!1),4e3)}}catch(a){console.error("Error updating role:",a),T("Network error while updating role"),D("error"),_(!0),setTimeout(()=>_(!1),4e3)}},className:"modal-body",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{className:"form-label",children:"Role Name *"}),(0,i.jsx)("input",{type:"text",name:"roleName",className:"form-input",value:N,onChange:e=>y(e.target.value),placeholder:"e.g., Regional Manager",required:!0}),(0,i.jsx)("small",{className:"text-muted",children:"Update the role name. The internal value will remain the same."})]}),(0,i.jsxs)("div",{className:"modal-footer",style:{borderTop:"2px solid var(--gray-200)",paddingTop:"12px",marginTop:"12px",display:"flex",gap:"12px",justifyContent:"flex-end"},children:[(0,i.jsx)("button",{type:"button",className:"btn-professional btn-secondary",onClick:()=>u(!1),children:"Cancel"}),(0,i.jsx)("button",{type:"submit",className:"btn-professional btn-success",children:"Update Role"})]})]})]})}),b&&(0,i.jsx)("div",{className:"modal-overlay confirm-overlay",onClick:()=>g(!1),children:(0,i.jsxs)("div",{className:"modal-content confirm-modal",onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("div",{className:"modal-header",children:(0,i.jsx)("h4",{className:"confirm-title",children:"Confirm Role Deletion"})}),(0,i.jsxs)("div",{className:"modal-body",children:[(0,i.jsxs)("p",{children:["Are you sure you want to delete the role ",(0,i.jsxs)("strong",{children:['"',null===w||void 0===w?void 0:w.label,'"']}),"?"]}),(0,i.jsxs)("p",{className:"text-warning",children:[(0,i.jsx)("i",{className:"bi bi-exclamation-triangle"}),"This action cannot be undone. Users with this role may lose access to certain features."]})]}),(0,i.jsxs)("div",{className:"modal-footer",children:[(0,i.jsx)("button",{className:"btn-professional btn-secondary",onClick:()=>g(!1),children:"Cancel"}),(0,i.jsx)("button",{className:"btn-professional btn-danger",onClick:e=>{e.preventDefault(),console.log("Delete confirmation clicked, calling handleDeleteRole"),(async()=>{if(console.log("handleDeleteRole called with roleToDelete:",w),w)try{const s=localStorage.getItem("token");console.log("Token exists:",!!s),console.log("Attempting to delete role:",w._id,w.label);const a=await fetch(`http://localhost:5000/api/roles/${w._id}`,{method:"DELETE",headers:{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}}});if(console.log("Delete response status:",a.status,a.statusText),a.ok){const e=await a.json();console.log("Delete successful:",e),c(e=>{const s=e.filter(e=>e._id!==w._id);return console.log("Updated roles list:",s),s}),S(null),g(!1),I(`Role "${w.label}" has been successfully deleted from the system!`),T(`Role "${w.label}" deleted successfully!`),D("success"),_(!0),setTimeout(()=>_(!1),4e3),window.dispatchEvent(new CustomEvent("roleDeleted",{detail:{value:w.value,label:w.label}}))}else{const s=await a.text();let l;console.error("Delete failed with response:",s);try{l=JSON.parse(s)}catch(e){l={message:s||"Failed to delete role"}}T(l.message||"Failed to delete role"),D("error"),_(!0),setTimeout(()=>_(!1),4e3),g(!1)}}catch(s){console.error("Error deleting role:",s),T("Network error while deleting role"),D("error"),_(!0),setTimeout(()=>_(!1),4e3),g(!1)}else console.error("No role to delete")})()},children:"Yes, Delete Role"})]})]})}),j&&(0,i.jsx)("div",{className:"modal-overlay",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:9999},children:(0,i.jsx)("div",{className:"modal-content success-modal-content",onClick:e=>e.stopPropagation(),style:{maxWidth:"500px",textAlign:"center",border:"3px solid #28a745",borderRadius:"15px",background:"linear-gradient(135deg, #f8f9fa, #e9ecef)",boxShadow:"0 10px 30px rgba(40, 167, 69, 0.3)",animation:"fadeInUp 0.3s ease-out"},children:(0,i.jsxs)("div",{style:{padding:"30px"},children:[(0,i.jsx)("div",{style:{fontSize:"60px",color:"#28a745",marginBottom:"20px",animation:"bounce 1s ease-in-out"},children:(0,i.jsx)("i",{className:"bi bi-check-circle-fill"})}),(0,i.jsx)("h2",{style:{color:"#28a745",marginBottom:"15px",fontWeight:"bold"},children:"Success!"}),(0,i.jsx)("p",{style:{fontSize:"16px",color:"#495057",marginBottom:"25px",lineHeight:"1.5"},children:B}),(0,i.jsxs)("button",{className:"btn-professional btn-success",onClick:()=>f(!1),style:{padding:"10px 30px",fontSize:"16px",fontWeight:"bold"},children:[(0,i.jsx)("i",{className:"bi bi-check2"})," Awesome!"]})]})})})]})}}}]);
//# sourceMappingURL=785.950b07d5.chunk.js.map